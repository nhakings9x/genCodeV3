@{
    ViewData["Title"] = "Gen Code V3";
    Layout = "_Layout.Ts";
}

@await Html.PartialAsync("_RequestWrap")
@await Html.PartialAsync("_ResponseWrap")

<script>
    var responseGolbal = [];

    // request
    function sendRequestGenCode() {
        var indexModel = $("#index_model").val()
        var formModel = $("#form_model").val()
        var optionModel = $("#option_model").val()
        responseGolbal = []
        cleanTreeFile()

        if (indexModel.trim() == "") {
            // alert("Chưa điền nội dung code C#")
            onShowToast("Chưa điền nội dung code C#")
            return
        }

        $.ajax({
            url: "GenCodeTs/GenCode",
            method: "POST",
            data: {
    @(nameof(GenCodeTsRequest.IndexModel)): indexModel,
    @(nameof(GenCodeTsRequest.FormModel)): formModel,
    @(nameof(GenCodeTsRequest.OptionModel)): optionModel
                },
    success: (res) => {
        responseGolbal = res
        genFormsModel(res.listFileForm)
        genFileModel(res.listFileModel)
        toggleRequestWrap()
        activeFileResFirst()
    },
        error: (err) => {
            onShowToast(err)
            console.log(err)
        }
            })
        }
    // <li><span class="file" > File 1.1 < /span></li >
    function genFileModel(listFileModel) {
        if (listFileModel) {
            listFileModel.forEach(x => {
                $("#model-file-wrap").append(`<li><span class="file" data-file-name="${x.fileName}"> ${x.fileName} </span></li >`)
            })
        }
    }

    function genFormsModel(listFileModel) {
        if (listFileModel) {
            listFileModel.forEach(x => {
                $("#forms-file-wrap").append(`<li><span class="file" data-file-name="${x.fileName}"> ${x.fileName} </span></li >`)
            })
        }
    }
</script>
@* test *@
<script>
    $("#index_model").val(`namespace GenCodeWebHNC.Models
    {
        public class GenCodeTsRequest
        {
            public string IndexModel { get; set; }

            public string FormModel { get; set; }

            public string OptionModel { get; set; }
        }
    }
    `)
    $("#form_model").val(`public class GenCodeTsResponse
        {
            public List<GenCodeTsFileResponse> ListFileForm { get; set; }

            public List<GenCodeTsFileResponse> ListFileModel { get; set; }

            public List<GenCodeTsFileResponse> ListFileService { get; set; }
        }`)
    $("#option_model").val(`public class GenCodeTsFileResponse
        {
            public string FileName { get; set; }

            public string Content { get; set; }
        }`)
</script>